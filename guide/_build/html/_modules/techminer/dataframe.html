
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>techminer.dataframe &#8212; techMiner - A Package for Bibliographical Analysis using Python 0.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">techMiner - A Package for Bibliographical Analysis using Python 0.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for techminer.dataframe</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">TechMiner.RecordsDataFrame</span>
<span class="sd">==================================================================================================</span>



<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="k">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">techminer.common</span> <span class="k">import</span> <span class="n">cut_text</span>
<span class="kn">from</span> <span class="nn">techminer.result</span> <span class="k">import</span> <span class="n">Result</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span> 
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">LineString</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>


<span class="c1">#---------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">_minmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">minmax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Selectet records among (minval, maxval) = minmax.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        data : df</span>

<span class="sd">    Returns:</span>
<span class="sd">        techminer.</span>


<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">if</span> <span class="n">minmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span> <span class="o">=</span> <span class="n">minmax</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">minval</span> <span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">maxval</span> <span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="c1">#------------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">z</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">data</span>



<span class="c1">#---------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame">[docs]</a><span class="k">class</span> <span class="nc">RecordsDataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent a dataframe of bibliographic records.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor_expanddim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="c1">#----------------------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_add_documents_by_terms_to_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span>

        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">count</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]])}</span>
        <span class="n">result</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cut_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_years_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">minyear</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Year</span><span class="p">)</span>
        <span class="n">maxyear</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Year</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">minyear</span><span class="p">,</span> <span class="n">maxyear</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_aduna_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># computes the number of documents by term</span>
        <span class="n">tdf_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tdf</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>        
        <span class="n">tdf_matrix</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">cut_text</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tdf_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="c1">## figure properties</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="c1">## graph</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>

        <span class="c1">## adds nodes to graph</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tdf_matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
        <span class="n">docs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdf_matrix</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))]</span>
        
        <span class="n">graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">tdf_matrix</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">tdf_matrix</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span> 

        <span class="c1">## graph layout</span>
        <span class="n">path_length</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">path_length</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">distances</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">distances</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

        <span class="c1">## draw terms nodes</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span>
            <span class="n">graph</span><span class="p">,</span> 
            <span class="n">layout</span><span class="p">,</span> 
            <span class="n">nodelist</span><span class="o">=</span><span class="n">terms</span><span class="p">,</span> 
            <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
            <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span>
            <span class="n">graph</span><span class="p">,</span> 
            <span class="n">layout</span><span class="p">,</span> 
            <span class="n">nodelist</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span> 
            <span class="n">node_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span> 

        <span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
        <span class="n">y_left</span><span class="p">,</span> <span class="n">y_right</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
        <span class="n">delta_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_right</span> <span class="o">-</span> <span class="n">x_left</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_right</span> <span class="o">-</span> <span class="n">y_left</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="c1"># for node in terms:</span>
        <span class="c1">#     x_pos, y_pos = layout[node]</span>
        <span class="c1">#     plt.text(</span>
        <span class="c1">#         x_pos + delta_x, </span>
        <span class="c1">#         y_pos + delta_y, </span>
        <span class="c1">#         node, </span>
        <span class="c1">#         size=font_size,</span>
        <span class="c1">#         ha=&#39;left&#39;,</span>
        <span class="c1">#         va=&#39;bottom&#39;,</span>
        <span class="c1">#         bbox=dict(</span>
        <span class="c1">#             boxstyle=&quot;square&quot;,</span>
        <span class="c1">#             ec=&#39;gray&#39;,</span>
        <span class="c1">#             fc=&#39;white&#39;,</span>
        <span class="c1">#             ))</span>

        <span class="c1">## edges</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span>
            <span class="n">graph</span><span class="p">,</span> 
            <span class="n">layout</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.auto_corr"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.auto_corr">[docs]</a>    <span class="k">def</span> <span class="nf">auto_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cut_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the autocorrelation among items in a column of the dataframe.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.auto_corr(column=&#39;Authors&#39;, sep=&#39;,&#39;, top_n=5) # doctest: +ELLIPSIS +NORMALIZE_WHITESPACE</span>
<span class="sd">               Authors (row)     Authors (col)  Autocorrelation                                                ID</span>
<span class="sd">        0        Wang J. [7]       Wang J. [7]              1.0  [[*3*], [*10*], [*15*], [*80*], [*87*], [*128*]]</span>
<span class="sd">        1       Zhang G. [4]      Zhang G. [4]              1.0                [[*27*], [*78*], [*117*], [*119*]]</span>
<span class="sd">        2   Hernandez G. [3]  Hernandez G. [3]              1.0                         [[*52*], [*94*], [*100*]]</span>
<span class="sd">        3         Yan X. [3]        Yan X. [3]              1.0                          [[*13*], [*44*], [*85*]]</span>
<span class="sd">        4       Tefas A. [3]      Tefas A. [3]              1.0                         [[*8*], [*110*], [*114*]]</span>
<span class="sd">        5   Hernandez G. [3]       Wang J. [7]              0.0                                              None</span>
<span class="sd">        6       Tefas A. [3]  Hernandez G. [3]              0.0                                              None</span>
<span class="sd">        7       Tefas A. [3]        Yan X. [3]              0.0                                              None</span>
<span class="sd">        8       Tefas A. [3]      Zhang G. [4]              0.0                                              None</span>
<span class="sd">        9       Tefas A. [3]       Wang J. [7]              0.0                                              None</span>
<span class="sd">        10  Hernandez G. [3]      Tefas A. [3]              0.0                                              None</span>
<span class="sd">        11       Wang J. [7]        Yan X. [3]              0.0                                              None</span>
<span class="sd">        12  Hernandez G. [3]        Yan X. [3]              0.0                                              None</span>
<span class="sd">        13  Hernandez G. [3]      Zhang G. [4]              0.0                                              None</span>
<span class="sd">        14       Wang J. [7]      Tefas A. [3]              0.0                                              None</span>
<span class="sd">        15      Zhang G. [4]       Wang J. [7]              0.0                                              None</span>
<span class="sd">        16        Yan X. [3]  Hernandez G. [3]              0.0                                              None</span>
<span class="sd">        17       Wang J. [7]      Zhang G. [4]              0.0                                              None</span>
<span class="sd">        18        Yan X. [3]      Zhang G. [4]              0.0                                              None</span>
<span class="sd">        19        Yan X. [3]       Wang J. [7]              0.0                                              None</span>
<span class="sd">        20      Zhang G. [4]      Tefas A. [3]              0.0                                              None</span>
<span class="sd">        21      Zhang G. [4]  Hernandez G. [3]              0.0                                              None</span>
<span class="sd">        22      Zhang G. [4]        Yan X. [3]              0.0                                              None</span>
<span class="sd">        23       Wang J. [7]  Hernandez G. [3]              0.0                                              None</span>
<span class="sd">        24        Yan X. [3]      Tefas A. [3]              0.0                                              None</span>
<span class="sd">       </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_corr</span><span class="p">(</span>
            <span class="n">column_r</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">column_c</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">sep_r</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">sep_c</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="n">top_n</span><span class="p">,</span> <span class="n">cut_value</span><span class="o">=</span><span class="n">cut_value</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_call</span> <span class="o">=</span> <span class="s1">&#39;auto_corr&#39;</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.citations_by_terms"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.citations_by_terms">[docs]</a>    <span class="k">def</span> <span class="nf">citations_by_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the number of citations by item in a column.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.citations_by_terms(column=&#39;Authors&#39;, sep=&#39;,&#39;, top_n=10)</span>
<span class="sd">                    Authors  Cited by                                  ID</span>
<span class="sd">        0     Yeh W.-C. [1]     188.0                           [[*140*]]</span>
<span class="sd">        1   Hsieh T.-J. [1]     188.0                           [[*140*]]</span>
<span class="sd">        2   Hsiao H.-F. [1]     188.0                           [[*140*]]</span>
<span class="sd">        3  Hussain A.J. [2]      52.0                  [[*125*], [*139*]]</span>
<span class="sd">        4     Krauss C. [1]      49.0                            [[*62*]]</span>
<span class="sd">        5    Fischer T. [1]      49.0                            [[*62*]]</span>
<span class="sd">        6       Wang J. [7]      46.0  [[*80*], [*87*], [*128*], [*128*]]</span>
<span class="sd">        7    Liatsis P. [1]      42.0                           [[*139*]]</span>
<span class="sd">        8    Ghazali R. [1]      42.0                           [[*139*]]</span>
<span class="sd">        9  Yoshihara A. [1]      37.0                           [[*124*]]</span>
<span class="sd">        &gt;&gt;&gt; rdf.citations_by_terms(column=&#39;Authors&#39;, sep=&#39;,&#39;, minmax=(30,50))</span>
<span class="sd">                       Authors  Cited by                                  ID</span>
<span class="sd">        0        Krauss C. [1]      49.0                            [[*62*]]</span>
<span class="sd">        1       Fischer T. [1]      49.0                            [[*62*]]</span>
<span class="sd">        2          Wang J. [7]      46.0  [[*80*], [*87*], [*128*], [*128*]]</span>
<span class="sd">        3       Liatsis P. [1]      42.0                           [[*139*]]</span>
<span class="sd">        4       Ghazali R. [1]      42.0                           [[*139*]]</span>
<span class="sd">        5     Yoshihara A. [1]      37.0                           [[*124*]]</span>
<span class="sd">        6     Matsubara T. [1]      37.0                           [[*124*]]</span>
<span class="sd">        7         Akita R. [1]      37.0                           [[*124*]]</span>
<span class="sd">        8        Uehara K. [1]      37.0                           [[*124*]]</span>
<span class="sd">        9      Passalis N. [3]      31.0                  [[*110*], [*114*]]</span>
<span class="sd">        10      Gabbouj M. [3]      31.0                  [[*110*], [*114*]]</span>
<span class="sd">        11   Kanniainen J. [3]      31.0                  [[*110*], [*114*]]</span>
<span class="sd">        12        Tefas A. [3]      31.0                  [[*110*], [*114*]]</span>
<span class="sd">        13  Tsantekidis A. [2]      31.0                  [[*110*], [*114*]]</span>
<span class="sd">        14    Iosifidis A. [3]      31.0                  [[*110*], [*114*]]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="n">column</span><span class="p">,</span> <span class="s1">&#39;Cited by&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>

        <span class="n">numcitations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">column</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
            <span class="s1">&#39;Cited by&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span>
        <span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">column</span> <span class="p">:</span> <span class="n">numcitations</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="s1">&#39;Cited by&#39;</span> <span class="p">:</span> <span class="n">numcitations</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Cited by&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>


        <span class="n">result</span> <span class="o">=</span> <span class="n">_minmax</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">minmax</span><span class="p">)</span>


        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">current_term</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_term</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">current_term</span><span class="p">,</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1">## counts the number of documents --------------------------------------------------------</span>

        <span class="n">resul</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_documents_by_terms_to_label</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>

        <span class="c1">## end -----------------------------------------------------------------------------------</span>
        
        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;citations_by_terms&#39;</span><span class="p">)</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.citations_by_terms_by_year"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.citations_by_terms_by_year">[docs]</a>    <span class="k">def</span> <span class="nf">citations_by_terms_by_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the number of citations by term by year in a column.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.citations_by_terms_by_year(&#39;Authors&#39;, sep=&#39;,&#39;, top_n=5)</span>
<span class="sd">                    Authors       Year  Cited by                  ID</span>
<span class="sd">        0  Hernandez G. [3]  2018 [52]       1.0           [[*100*]]</span>
<span class="sd">        1      Tefas A. [3]  2017 [19]      31.0  [[*110*], [*114*]]</span>
<span class="sd">        2       Wang J. [7]   2016 [5]      38.0  [[*128*], [*128*]]</span>
<span class="sd">        3       Wang J. [7]  2018 [52]       8.0    [[*80*], [*87*]]</span>
<span class="sd">        4      Zhang G. [4]  2017 [19]       8.0  [[*117*], [*119*]]</span>
<span class="sd">        5      Zhang G. [4]  2018 [52]       1.0            [[*78*]]</span>
<span class="sd">        6      Zhang G. [4]  2019 [53]       3.0            [[*27*]]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="n">column</span><span class="p">,</span> <span class="s1">&#39;Cited by&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>

        <span class="n">numcitations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">column</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
            <span class="s1">&#39;Cited by&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span>
        <span class="p">})</span>

        <span class="c1">## results dataframe</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">numcitations</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">numcitations</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">column</span> <span class="p">:</span> <span class="n">a</span><span class="p">,</span>
            <span class="s1">&#39;Year&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;Cited by&#39;</span> <span class="p">:</span> <span class="n">numcitations</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">})</span>

        <span class="c1">## rows</span>
        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">top</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span> 
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">_minmax</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">minmax</span><span class="p">)</span>
        

        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
    
        <span class="c1">## counts the number of ddcuments only in the results matrix -----------------------</span>

        <span class="n">resul</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_documents_by_terms_to_label</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="n">resul</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_documents_by_terms_to_label</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;citations_by_terms_by_year&#39;</span><span class="p">)</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.citations_by_year"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.citations_by_year">[docs]</a>    <span class="k">def</span> <span class="nf">citations_by_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the number of citations by year.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.citations_by_year().head()</span>
<span class="sd">               Year  Cited by                                    ID</span>
<span class="sd">        0  2010 [3]      21.0                    [[*142*], [*143*]]</span>
<span class="sd">        1  2011 [2]     230.0                    [[*139*], [*140*]]</span>
<span class="sd">        2  2012 [2]      16.0                    [[*137*], [*138*]]</span>
<span class="sd">        3  2013 [4]      36.0  [[*133*], [*134*], [*135*], [*136*]]</span>
<span class="sd">        4  2014 [2]      23.0                    [[*131*], [*132*]]</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">## computes number of citations</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Cited by&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">citations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
            <span class="s1">&#39;Cited by&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span>
        <span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_years_list</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">citations</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Cited by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">citations</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="c1">## IDs ---------------------------------------------------------------------------------</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1">## end ----------------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">cumulative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

       <span class="c1">## counts the number of documents --------------------------------------------------------</span>

        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_year</span><span class="p">(</span><span class="n">cumulative</span><span class="o">=</span><span class="n">cumulative</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">count</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]])}</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cut_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">))</span>

        <span class="c1">## end -----------------------------------------------------------------------------------</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;citations_by_year&#39;</span><span class="p">)</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.co_ocurrence"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.co_ocurrence">[docs]</a>    <span class="k">def</span> <span class="nf">co_ocurrence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="n">sep_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep_c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the number of rows containing two given items in different columns.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.co_ocurrence(column_r=&#39;Authors&#39;, sep_r=&#39;,&#39;, column_c=&#39;Document Type&#39;, top_n=5)</span>
<span class="sd">              Authors (row)    Document Type (col)  Num Documents                                         ID</span>
<span class="sd">        0  Hernandez G. [3]  Conference Paper [12]              3                  [[*52*], [*94*], [*100*]]</span>
<span class="sd">        1      Tefas A. [3]  Conference Paper [12]              3                  [[*8*], [*110*], [*114*]]</span>
<span class="sd">        2       Wang J. [7]            Article [8]              5  [[*3*], [*10*], [*80*], [*128*], [*128*]]</span>
<span class="sd">        3       Wang J. [7]  Conference Paper [12]              2                           [[*15*], [*87*]]</span>
<span class="sd">        4        Yan X. [3]            Article [8]              1                                   [[*44*]]</span>
<span class="sd">        5        Yan X. [3]  Conference Paper [12]              2                           [[*13*], [*85*]]</span>
<span class="sd">        6      Zhang G. [4]            Article [8]              2                          [[*27*], [*117*]]</span>
<span class="sd">        7      Zhang G. [4]  Conference Paper [12]              2                          [[*78*], [*119*]]</span>
<span class="sd">        </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">## computes the number of documents by term by term        </span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">top_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column_r</span><span class="p">,</span> <span class="n">sep_r</span><span class="p">)</span>
        <span class="n">top_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column_c</span><span class="p">,</span> <span class="n">sep_c</span><span class="p">)</span>

        <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_r</span> <span class="o">+</span> <span class="s1">&#39; (row)&#39;</span><span class="p">,</span> <span class="n">column_c</span> <span class="o">+</span> <span class="s1">&#39; (col)&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span> <span class="p">]</span>
        <span class="n">column_r</span> <span class="o">+=</span>  <span class="s1">&#39; (row)&#39;</span>
        <span class="n">column_c</span> <span class="o">+=</span>  <span class="s1">&#39; (col)&#39;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_r</span><span class="p">,</span> <span class="n">sep_r</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="n">sep_c</span><span class="p">)</span>

        <span class="c1">## number of documents</span>
        <span class="n">numdocs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

        <span class="c1">## results dataframe</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">column_r</span> <span class="p">:</span> <span class="n">a</span><span class="p">,</span>
            <span class="n">column_c</span> <span class="p">:</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;Num Documents&#39;</span> <span class="p">:</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">})</span>

        <span class="c1">## compute top_n terms</span>
        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">## rows</span>
            <span class="c1"># top = self.documents_by_terms(column_r, sep_r)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
                <span class="n">top_r</span> <span class="o">=</span> <span class="n">top_r</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">][</span><span class="n">top_r</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">top_r</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span> 
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>

            <span class="c1">## cols</span>
            <span class="c1"># top = self.documents_by_terms(column_c, sep_c)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
                <span class="n">top_c</span> <span class="o">=</span> <span class="n">top_c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">][</span><span class="n">top_c</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">top_c</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span> 
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>
            
        <span class="n">result</span> <span class="o">=</span> <span class="n">_minmax</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">minmax</span><span class="p">)</span>


        <span class="c1">## collects the references</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">term0</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">term1</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">column_r</span><span class="p">]</span> <span class="o">==</span> <span class="n">term0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column_c</span><span class="p">]</span> <span class="o">==</span> <span class="n">term1</span><span class="p">)][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="c1">## counts the number of ddcuments only in the results matrix -----------------------</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;citations_by_year&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="n">column_r</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="n">column_c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.coverage"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.coverage">[docs]</a>    <span class="k">def</span> <span class="nf">coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Counts the number of None values per column.</span>


<span class="sd">        Returns:</span>
<span class="sd">            Pandas DataFrame.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.coverage()</span>
<span class="sd">                         Field  Number of items Coverage (%)</span>
<span class="sd">        0              Authors              144      100.00%</span>
<span class="sd">        1         Author(s) ID              144      100.00%</span>
<span class="sd">        2                Title              144      100.00%</span>
<span class="sd">        3                 Year              144      100.00%</span>
<span class="sd">        4         Source title              144      100.00%</span>
<span class="sd">        5               Volume               97       67.36%</span>
<span class="sd">        6                Issue               27       18.75%</span>
<span class="sd">        7             Art. No.               49       34.03%</span>
<span class="sd">        8           Page start              119       82.64%</span>
<span class="sd">        9             Page end              119       82.64%</span>
<span class="sd">        10          Page count                0        0.00%</span>
<span class="sd">        11            Cited by               68       47.22%</span>
<span class="sd">        12                 DOI              133       92.36%</span>
<span class="sd">        13        Affiliations              143       99.31%</span>
<span class="sd">        14       Document Type              144      100.00%</span>
<span class="sd">        15         Access Type               16       11.11%</span>
<span class="sd">        16              Source              144      100.00%</span>
<span class="sd">        17                 EID              144      100.00%</span>
<span class="sd">        18            Abstract              144      100.00%</span>
<span class="sd">        19     Author Keywords              124       86.11%</span>
<span class="sd">        20      Index Keywords              123       85.42%</span>
<span class="sd">        21          References              137       95.14%</span>
<span class="sd">        22            keywords              144      100.00%</span>
<span class="sd">        23                CONF              144      100.00%</span>
<span class="sd">        24  keywords (cleaned)              144      100.00%</span>
<span class="sd">        25            SELECTED              144      100.00%</span>
<span class="sd">        26                  ID              144      100.00%</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;Field&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="s1">&#39;Number of items&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
            <span class="s1">&#39;Coverage (%)&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;</span><span class="si">{:5.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">result</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.cross_corr"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.cross_corr">[docs]</a>    <span class="k">def</span> <span class="nf">cross_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep_c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cut_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the crosscorrelation among items in two different columns of the dataframe.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.cross_corr(column_r=&#39;Authors&#39;, sep_r=&#39;,&#39;, column_c=&#39;Author Keywords&#39;, sep_c=&#39;;&#39;, top_n=5)</span>
<span class="sd">                     Authors               Author Keywords  Crosscorrelation                 ID</span>
<span class="sd">        0         Yan X. [3]     Financial time series [7]          0.218218           [[*13*]]</span>
<span class="sd">        1   Hernandez G. [3]            Deep learning [34]          0.198030  [[*94*], [*100*]]</span>
<span class="sd">        2       Zhang G. [4]     Financial time series [7]          0.188982          [[*119*]]</span>
<span class="sd">        3       Zhang G. [4]            Deep learning [34]          0.171499  [[*27*], [*117*]]</span>
<span class="sd">        4       Zhang G. [4]            Deep Learning [10]          0.158114           [[*78*]]</span>
<span class="sd">        5        Wang J. [7]            Deep learning [34]          0.140028    [[*3*], [*87*]]</span>
<span class="sd">        6        Wang J. [7]            Deep Learning [10]          0.129099           [[*15*]]</span>
<span class="sd">        7         Yan X. [3]            Deep learning [34]          0.099015           [[*13*]]</span>
<span class="sd">        8   Hernandez G. [3]                     LSTM [18]          0.000000               None</span>
<span class="sd">        9       Tefas A. [3]  Recurrent neural network [8]          0.000000               None</span>
<span class="sd">        10      Tefas A. [3]            Deep Learning [10]          0.000000               None</span>
<span class="sd">        11      Tefas A. [3]                     LSTM [18]          0.000000               None</span>
<span class="sd">        12      Tefas A. [3]            Deep learning [34]          0.000000               None</span>
<span class="sd">        13  Hernandez G. [3]     Financial time series [7]          0.000000               None</span>
<span class="sd">        14  Hernandez G. [3]  Recurrent neural network [8]          0.000000               None</span>
<span class="sd">        15  Hernandez G. [3]            Deep Learning [10]          0.000000               None</span>
<span class="sd">        16        Yan X. [3]            Deep Learning [10]          0.000000               None</span>
<span class="sd">        17        Yan X. [3]  Recurrent neural network [8]          0.000000               None</span>
<span class="sd">        18       Wang J. [7]                     LSTM [18]          0.000000               None</span>
<span class="sd">        19        Yan X. [3]                     LSTM [18]          0.000000               None</span>
<span class="sd">        20      Zhang G. [4]  Recurrent neural network [8]          0.000000               None</span>
<span class="sd">        21      Zhang G. [4]                     LSTM [18]          0.000000               None</span>
<span class="sd">        22       Wang J. [7]     Financial time series [7]          0.000000               None</span>
<span class="sd">        23       Wang J. [7]  Recurrent neural network [8]          0.000000               None</span>
<span class="sd">        24      Tefas A. [3]     Financial time series [7]          0.000000               None</span>

<span class="sd">        </span>

<span class="sd">        &quot;&quot;&quot;</span> 
 
        <span class="k">if</span> <span class="n">column_r</span> <span class="o">==</span> <span class="n">column_c</span><span class="p">:</span>
            <span class="n">sep_c</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">column_c</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">tdf_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tdf</span><span class="p">(</span><span class="n">column_r</span><span class="p">,</span> <span class="n">sep_r</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">column_c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tdf_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tdf</span><span class="p">(</span><span class="n">column_c</span><span class="p">,</span> <span class="n">sep_c</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tdf_c</span> <span class="o">=</span> <span class="n">tdf_r</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="n">column_c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">col0</span> <span class="o">=</span> <span class="n">column_r</span>
            <span class="n">col1</span> <span class="o">=</span> <span class="n">column_c</span>
            <span class="n">col2</span> <span class="o">=</span> <span class="s1">&#39;Crosscorrelation&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col0</span> <span class="o">=</span> <span class="n">column_r</span> <span class="o">+</span> <span class="s1">&#39; (row)&#39;</span>
            <span class="n">col1</span> <span class="o">=</span> <span class="n">column_r</span> <span class="o">+</span> <span class="s1">&#39; (col)&#39;</span>
            <span class="n">col2</span> <span class="o">=</span> <span class="s1">&#39;Autocorrelation&#39;</span>

        <span class="n">terms_r</span> <span class="o">=</span> <span class="n">tdf_r</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">terms_c</span> <span class="o">=</span> <span class="n">tdf_c</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">col0</span> <span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">terms_r</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms_c</span><span class="p">)),</span>
            <span class="n">col1</span> <span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">terms_r</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms_c</span><span class="p">)),</span>
            <span class="n">col2</span> <span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">terms_r</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms_c</span><span class="p">))</span>   
        <span class="p">})</span>

        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">terms_r</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">terms_c</span><span class="p">:</span>

                <span class="n">s1</span> <span class="o">=</span> <span class="n">tdf_r</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">tdf_c</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

                <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">s1</span> <span class="o">*</span> <span class="n">s2</span><span class="p">))</span>
                <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">value</span> <span class="o">=</span>  <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">selected_IDs</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[(</span><span class="n">s1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1">#result = result.style.format(&#39;{0:.4}&#39;)</span>

        <span class="c1">## cluster computation -------------------------------------------------------------------</span>
        
        <span class="c1">## number of clusters</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;cross_corr&#39;</span><span class="p">)</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">tomatrix</span><span class="p">()</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">columns</span>

        <span class="c1">## dataframe with relationships among items</span>
        <span class="n">map_cluster</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">map_from</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">map_to</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">map_similariry</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">map_color</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab20&#39;</span><span class="p">)</span>

        <span class="c1">## similarity computation</span>
        <span class="k">for</span> <span class="n">idx_cluster</span><span class="p">,</span> <span class="n">cluster_term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>

            <span class="c1">## terms in r selected in the current cluster</span>
            <span class="n">cluster_index</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">mtx</span><span class="p">[</span><span class="n">cluster_term</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">idx0_r</span><span class="p">,</span> <span class="n">term0_r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cluster_index</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">idx1_r</span><span class="p">,</span> <span class="n">term1_r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cluster_index</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">idx1_r</span>  <span class="o">&lt;=</span> <span class="n">idx0_r</span><span class="p">:</span>
                        <span class="k">continue</span>
                    
                    <span class="c1">## docs related to term0 and term1</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tdf_r</span><span class="p">[</span><span class="n">term0_r</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">tdf_r</span><span class="p">[</span><span class="n">term1_r</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="n">tdf_similarity</span> <span class="o">=</span> <span class="n">tdf_c</span><span class="p">[</span> <span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tdf_c</span><span class="p">[</span><span class="n">cluster_term</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>

                    <span class="n">jaccard</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">n_jaccard</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="k">for</span> <span class="n">idx_i</span><span class="p">,</span> <span class="n">doc_i</span> <span class="ow">in</span> <span class="n">tdf_similarity</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">idx_j</span><span class="p">,</span> <span class="n">doc_j</span> <span class="ow">in</span> <span class="n">tdf_similarity</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    
                            <span class="k">if</span> <span class="n">idx_i</span> <span class="o">==</span> <span class="n">idx_j</span><span class="p">:</span>
                                <span class="k">break</span>

                            <span class="n">terms_i</span> <span class="o">=</span> <span class="n">doc_i</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                            <span class="n">terms_j</span> <span class="o">=</span> <span class="n">doc_j</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                            <span class="n">intersection</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">terms_i</span><span class="p">,</span> <span class="n">terms_j</span><span class="p">)]</span>

                            <span class="n">len_i</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">terms_i</span><span class="p">)</span>
                            <span class="n">len_j</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">terms_j</span><span class="p">)</span>
                            <span class="n">len_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span>

                            <span class="n">jaccard</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">len_c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">len_i</span> <span class="o">+</span> <span class="n">len_j</span> <span class="o">-</span> <span class="n">len_c</span><span class="p">)</span>
                            <span class="n">n_jaccard</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">n_jaccard</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">jaccard</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">jaccard</span> <span class="o">=</span> <span class="n">jaccard</span> <span class="o">/</span> <span class="n">n_jaccard</span>

                    <span class="n">map_cluster</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cluster_term</span><span class="p">]</span>
                    <span class="n">map_from</span> <span class="o">+=</span> <span class="p">[</span><span class="n">term0_r</span><span class="p">]</span>
                    <span class="n">map_to</span> <span class="o">+=</span> <span class="p">[</span><span class="n">term1_r</span><span class="p">]</span>
                    <span class="n">map_similariry</span> <span class="o">+=</span> <span class="p">[</span><span class="n">jaccard</span><span class="p">]</span>
                    <span class="n">map_color</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">idx_cluster</span><span class="p">))]</span>

        <span class="n">map_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;cluster&#39;</span> <span class="p">:</span> <span class="n">map_cluster</span><span class="p">,</span>
            <span class="s1">&#39;from_node&#39;</span> <span class="p">:</span> <span class="n">map_from</span><span class="p">,</span>
            <span class="s1">&#39;to_node&#39;</span> <span class="p">:</span> <span class="n">map_to</span><span class="p">,</span>
            <span class="s1">&#39;similarity&#39;</span> <span class="p">:</span> <span class="n">map_similariry</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="n">map_color</span> 
        <span class="p">})</span>
        <span class="n">map_data</span> <span class="o">=</span> <span class="n">map_data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;from_node&#39;</span><span class="p">,</span> <span class="s1">&#39;to_node&#39;</span><span class="p">])</span>

        <span class="c1">## end -----------------------------------------------------------------------------------</span>

        <span class="c1">## line style for diagrams ---------------------------------------------------------------</span>
        <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">map_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.75</span><span class="p">:</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> 
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.50</span><span class="p">:</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> 
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.25</span><span class="p">:</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span> 
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">:</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>

        <span class="c1">## end -----------------------------------------------------------------------------------</span>

        <span class="c1">## adds number of records to columns -----------------------------------------------------</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column_r</span><span class="p">,</span> <span class="n">sep_r</span><span class="p">)</span>
        <span class="n">new_names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">num</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">old_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">old_name</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
            <span class="n">new_names</span><span class="p">[</span><span class="n">old_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>

        <span class="n">result</span><span class="p">[</span><span class="n">col0</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">col0</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

        <span class="c1">## &gt;&gt;&gt; adds number of records to cluster nodes ------------------------------------------------</span>
        <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;from_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;from_node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;to_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;to_node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="c1">## &lt;&lt;&lt; end ------------------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">column_c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column_c</span><span class="p">,</span> <span class="n">sep_c</span><span class="p">)</span>
            <span class="n">new_names</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">num</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">old_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="n">old_name</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
                <span class="n">new_names</span><span class="p">[</span><span class="n">old_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>

        <span class="n">result</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="c1">## end ------------------------------------------------------------------------------------</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;cross_corr&#39;</span><span class="p">,</span> <span class="n">cluster_data</span><span class="o">=</span><span class="n">map_data</span><span class="p">)</span></div>


    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.documents_by_terms"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.documents_by_terms">[docs]</a>    <span class="k">def</span> <span class="nf">documents_by_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the number of documents per term in a given column.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.documents_by_terms(&#39;Authors&#39;, sep=&#39;,&#39;).head(5)</span>
<span class="sd">                Authors  Num Documents                                                 ID</span>
<span class="sd">        0       Wang J.              7  [[*3*], [*10*], [*15*], [*80*], [*87*], [*128*...</span>
<span class="sd">        1      Zhang G.              4                 [[*27*], [*78*], [*117*], [*119*]]</span>
<span class="sd">        2        Yan X.              3                           [[*13*], [*44*], [*85*]]</span>
<span class="sd">        3  Hernandez G.              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        4      Tefas A.              3                          [[*8*], [*110*], [*114*]]</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># computes the number of documents by term</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="n">column</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>

        <span class="n">numdocs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        
        <span class="c1">## dataframe with results</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">column</span> <span class="p">:</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="s1">&#39;Num Documents&#39;</span> <span class="p">:</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Num Documents&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>

        <span class="c1">## compute top_n terms</span>
        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>


        <span class="n">result</span> <span class="o">=</span> <span class="n">_minmax</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">minmax</span><span class="p">)</span>


        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">current_term</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_term</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">current_term</span><span class="p">,</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;documents_by_terms&#39;</span><span class="p">)</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.documents_by_year"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.documents_by_year">[docs]</a>    <span class="k">def</span> <span class="nf">documents_by_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the number of documents per year.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.documents_by_year().head()</span>
<span class="sd">           Year  Num Documents                                    ID</span>
<span class="sd">        0  2010              3           [[*141*], [*142*], [*143*]]</span>
<span class="sd">        1  2011              2                    [[*139*], [*140*]]</span>
<span class="sd">        2  2012              2                    [[*137*], [*138*]]</span>
<span class="sd">        3  2013              4  [[*133*], [*134*], [*135*], [*136*]]</span>
<span class="sd">        4  2014              2                    [[*131*], [*132*]]</span>
<span class="sd">        &gt;&gt;&gt; rdf.documents_by_year(cumulative=True).head()</span>
<span class="sd">           Year  Num Documents                                    ID</span>
<span class="sd">        0  2010              3           [[*141*], [*142*], [*143*]]</span>
<span class="sd">        1  2011              5                    [[*139*], [*140*]]</span>
<span class="sd">        2  2012              7                    [[*137*], [*138*]]</span>
<span class="sd">        3  2013             11  [[*133*], [*134*], [*135*], [*136*]]</span>
<span class="sd">        4  2014             13                    [[*131*], [*132*]]</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">## number of documents by year</span>
        <span class="n">numdocs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[[</span><span class="s1">&#39;Year&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="c1">## dataframe with results</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_years_list</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Num Documents&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;Num Documents&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numdocs</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cumulative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Num Documents&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Num Documents&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">current_term</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]:</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_term</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">current_term</span><span class="p">,</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;documents_by_year&#39;</span><span class="p">)</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.factor_analysis"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.factor_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">factor_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the matrix of factors for terms in a given column.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.factor_analysis(</span>
<span class="sd">        ...    column=&#39;Authors&#39;, </span>
<span class="sd">        ...    sep=&#39;,&#39;, </span>
<span class="sd">        ...    n_components=5, </span>
<span class="sd">        ...    top_n=40).tomatrix().head(5) # doctest: +ELLIPSIS +NORMALIZE_WHITESPACE</span>
<span class="sd">                                F0        F1        F2        F3        F4</span>
<span class="sd">        Wang J. [7]      -0.025355 -0.040096 -0.695298  0.624399  0.223693</span>
<span class="sd">        Zhang G. [4]     -0.017487 -0.028221  0.452656  0.559642 -0.167425</span>
<span class="sd">        Yan X. [3]       -0.010094 -0.013940 -0.057740 -0.006361 -0.018068</span>
<span class="sd">        Hernandez G. [3] -0.029542  0.489821  0.002071  0.023022  0.012202</span>
<span class="sd">        Tefas A. [3]      0.425717  0.023641  0.001237  0.014415  0.007825</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">tdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tdf</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="n">tdf</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">n_components</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_components</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">terms</span><span class="p">))))</span>

        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
        
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">tdf</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;F&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">)]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">))]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="n">t</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">)</span> <span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">)]</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">column</span> <span class="p">:</span> <span class="n">rows</span><span class="p">,</span>
            <span class="s1">&#39;Factor&#39;</span> <span class="p">:</span> <span class="n">cols</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span> <span class="p">:</span> <span class="n">values</span><span class="p">})</span>


        <span class="c1">## cluster computation -------------------------------------------------------------------</span>
        
        <span class="n">tdf_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tdf</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
        <span class="n">tdf_c</span> <span class="o">=</span> <span class="n">tdf_r</span>

        <span class="c1">## number of clusters</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;factor_analysis&#39;</span><span class="p">)</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">tomatrix</span><span class="p">()</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">columns</span>

        <span class="c1">## dataframe with relationships among items</span>
        <span class="n">map_cluster</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">map_from</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">map_to</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">map_similariry</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">map_color</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab20&#39;</span><span class="p">)</span>


        <span class="c1">## similarity computation</span>
        <span class="k">for</span> <span class="n">idx_cluster</span><span class="p">,</span> <span class="n">cluster_term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>

            <span class="c1">## terms in r selected in the current cluster</span>
            <span class="n">cluster_index</span> <span class="o">=</span> <span class="n">mtx</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">mtx</span><span class="p">[</span><span class="n">cluster_term</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">idx0_r</span><span class="p">,</span> <span class="n">term0_r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cluster_index</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">idx1_r</span><span class="p">,</span> <span class="n">term1_r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cluster_index</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">idx1_r</span>  <span class="o">&lt;=</span> <span class="n">idx0_r</span><span class="p">:</span>
                        <span class="k">continue</span>
                    
                    <span class="c1">## docs related to term0 and term1</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tdf_r</span><span class="p">[</span><span class="n">term0_r</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">tdf_r</span><span class="p">[</span><span class="n">term1_r</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="n">tdf_similarity</span> <span class="o">=</span> <span class="n">tdf_c</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

                    <span class="n">jaccard</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">n_jaccard</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="k">for</span> <span class="n">idx_i</span><span class="p">,</span> <span class="n">doc_i</span> <span class="ow">in</span> <span class="n">tdf_similarity</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">idx_j</span><span class="p">,</span> <span class="n">doc_j</span> <span class="ow">in</span> <span class="n">tdf_similarity</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    
                            <span class="k">if</span> <span class="n">idx_i</span> <span class="o">==</span> <span class="n">idx_j</span><span class="p">:</span>
                                <span class="k">break</span>

                            <span class="n">terms_i</span> <span class="o">=</span> <span class="n">doc_i</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                            <span class="n">terms_j</span> <span class="o">=</span> <span class="n">doc_j</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                            <span class="n">intersection</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">terms_i</span><span class="p">,</span> <span class="n">terms_j</span><span class="p">)]</span>

                            <span class="n">len_i</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">terms_i</span><span class="p">)</span>
                            <span class="n">len_j</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">terms_j</span><span class="p">)</span>
                            <span class="n">len_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span>

                            <span class="n">jaccard</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">len_c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">len_i</span> <span class="o">+</span> <span class="n">len_j</span> <span class="o">-</span> <span class="n">len_c</span><span class="p">)</span>
                            <span class="n">n_jaccard</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">n_jaccard</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">jaccard</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">jaccard</span> <span class="o">=</span> <span class="n">jaccard</span> <span class="o">/</span> <span class="n">n_jaccard</span>

                    <span class="n">map_cluster</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cluster_term</span><span class="p">]</span>
                    <span class="n">map_from</span> <span class="o">+=</span> <span class="p">[</span><span class="n">term0_r</span><span class="p">]</span>
                    <span class="n">map_to</span> <span class="o">+=</span> <span class="p">[</span><span class="n">term1_r</span><span class="p">]</span>
                    <span class="n">map_similariry</span> <span class="o">+=</span> <span class="p">[</span><span class="n">jaccard</span><span class="p">]</span>
                    <span class="n">map_color</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">idx_cluster</span><span class="p">))]</span>

        <span class="n">map_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;cluster&#39;</span> <span class="p">:</span> <span class="n">map_cluster</span><span class="p">,</span>
            <span class="s1">&#39;from_node&#39;</span> <span class="p">:</span> <span class="n">map_from</span><span class="p">,</span>
            <span class="s1">&#39;to_node&#39;</span> <span class="p">:</span> <span class="n">map_to</span><span class="p">,</span>
            <span class="s1">&#39;similarity&#39;</span> <span class="p">:</span> <span class="n">map_similariry</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="n">map_color</span>  
        <span class="p">})</span>
        <span class="n">map_data</span> <span class="o">=</span> <span class="n">map_data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;from_node&#39;</span><span class="p">,</span> <span class="s1">&#39;to_node&#39;</span><span class="p">])</span>
        <span class="c1">## end -----------------------------------------------------------------------------------</span>

         <span class="c1">## line style for diagrams ---------------------------------------------------------------</span>
        <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">map_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.75</span><span class="p">:</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> 
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.50</span><span class="p">:</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> 
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.25</span><span class="p">:</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span> 
                <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">:</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">map_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>

        <span class="c1">## end -----------------------------------------------------------------------------------</span>


        <span class="c1">## adds number of records to columns</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="n">new_names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">num</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">old_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">old_name</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
            <span class="n">new_names</span><span class="p">[</span><span class="n">old_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>
        <span class="n">result</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="c1">## end </span>

        <span class="c1">## &gt;&gt;&gt; adds number of records to cluster nodes ------------------------------------------------</span>
        <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;from_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;from_node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;to_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_data</span><span class="p">[</span><span class="s1">&#39;to_node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="c1">## &lt;&lt;&lt; end ------------------------------------------------------------------------------------</span>

        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;factor_analysis&#39;</span><span class="p">,</span> <span class="n">cluster_data</span><span class="o">=</span><span class="n">map_data</span><span class="p">)</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.generate_ID"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.generate_ID">[docs]</a>    <span class="k">def</span> <span class="nf">generate_ID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a unique ID for each document.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;[*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;*]&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.get_records_by_IDs"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.get_records_by_IDs">[docs]</a>    <span class="k">def</span> <span class="nf">get_records_by_IDs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">IDs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extracts records using the ID number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">IDs</span><span class="p">:</span>
            <span class="n">rdf</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">rdf</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rdf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.most_cited_documents"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.most_cited_documents">[docs]</a>    <span class="k">def</span> <span class="nf">most_cited_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the top N most cited documents and citations &gt; min_value .</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            top_n (int) : number of documents to be returned.</span>
<span class="sd">            minmax ((int, int) tuple) : minimal number of citations</span>

<span class="sd">        Results:</span>
<span class="sd">            pandas.DataFrame</span>


<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.most_cited_documents(top_n=5)[[&#39;Authors&#39;, &#39;Title&#39;]]</span>
<span class="sd">                                                     Authors                                              Title</span>
<span class="sd">        140              Hsieh T.-J., Hsiao H.-F., Yeh W.-C.  Forecasting stock markets using wavelet transf...</span>
<span class="sd">        62                             Fischer T., Krauss C.  Deep learning with long short-term memory netw...</span>
<span class="sd">        139             Ghazali R., Hussain A.J., Liatsis P.  Dynamic Ridge Polynomial Neural Network: Forec...</span>
<span class="sd">        124  Akita R., Yoshihara A., Matsubara T., Uehara K.  Deep learning for stock prediction using numer...</span>
<span class="sd">        134                         Sharma V., Srinivasan D.  A hybrid intelligent model based on recurrent ...</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Cited by&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">minmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span> <span class="o">=</span> <span class="n">minmax</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minval</span> <span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;Cited by&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">maxval</span> <span class="p">]</span>
        
        <span class="k">return</span> <span class="n">result</span><span class="p">[[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Authors&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Cited by&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_of_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of source titles in the dataframe.</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.num_of_sources</span>
<span class="sd">        103</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Source title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.ocurrence"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.ocurrence">[docs]</a>    <span class="k">def</span> <span class="nf">ocurrence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.ocurrence(column=&#39;Authors&#39;, sep=&#39;,&#39;, top_n=10)</span>
<span class="sd">               Authors (row)     Authors (col)  Num Documents                                                 ID</span>
<span class="sd">        0     Arévalo A. [9]    Arévalo A. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        1     Arévalo A. [9]  Hernandez G. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        2     Arévalo A. [9]   Sandoval J. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        3   Hernandez G. [9]    Arévalo A. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        4   Hernandez G. [9]  Hernandez G. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        5   Hernandez G. [9]   Sandoval J. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        6   Iosifidis A. [6]  Iosifidis A. [6]              3                          [[*8*], [*110*], [*114*]]</span>
<span class="sd">        7   Iosifidis A. [6]      Tefas A. [6]              3                          [[*8*], [*110*], [*114*]]</span>
<span class="sd">        8    Sandoval J. [9]    Arévalo A. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        9    Sandoval J. [9]  Hernandez G. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        10   Sandoval J. [9]   Sandoval J. [9]              3                          [[*52*], [*94*], [*100*]]</span>
<span class="sd">        11      Tefas A. [6]  Iosifidis A. [6]              3                          [[*8*], [*110*], [*114*]]</span>
<span class="sd">        12      Tefas A. [6]      Tefas A. [6]              3                          [[*8*], [*110*], [*114*]]</span>
<span class="sd">        13       Wang J. [9]       Wang J. [9]              9  [[*3*], [*10*], [*15*], [*80*], [*87*], [*128*...</span>
<span class="sd">        14         Wu J. [3]         Wu J. [3]              3                          [[*34*], [*66*], [*115*]]</span>
<span class="sd">        15        Yan X. [3]        Yan X. [3]              3                           [[*13*], [*44*], [*85*]]</span>
<span class="sd">        16      Zhang G. [4]      Zhang G. [4]              4                 [[*27*], [*78*], [*117*], [*119*]]</span>
<span class="sd">        17      Zhang Y. [3]      Zhang Y. [3]              3                            [[*4*], [*6*], [*109*]]</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">## computes the number of documents by term by term        </span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="n">column</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39; (row)&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39; (col)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39; (row)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        
        <span class="n">column_r</span> <span class="o">=</span> <span class="n">column</span> <span class="o">+</span> <span class="s1">&#39; (row)&#39;</span>
        <span class="n">column_c</span> <span class="o">=</span> <span class="n">column</span> <span class="o">+</span> <span class="s1">&#39; (col)&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_r</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>

        <span class="c1">## number of documents</span>
        <span class="n">numdocs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

        <span class="c1">## results dataframe</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">column_r</span> <span class="p">:</span> <span class="n">a</span><span class="p">,</span>
            <span class="n">column_c</span> <span class="p">:</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;Num Documents&#39;</span> <span class="p">:</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">})</span>

        <span class="c1">## compute top_n terms</span>
        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">## rows</span>
            <span class="c1"># top = self.documents_by_terms(column_r, sep_r)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>

                <span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">][</span><span class="n">top</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">top</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span> 
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>

                <span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">top</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span> 
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>
            

        <span class="n">result</span> <span class="o">=</span> <span class="n">_minmax</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">minmax</span><span class="p">)</span>


        <span class="c1">## collects the references</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">term0</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">term1</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">column_r</span><span class="p">]</span> <span class="o">==</span> <span class="n">term0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column_c</span><span class="p">]</span> <span class="o">==</span> <span class="n">term1</span><span class="p">)][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="c1">## counts the number of ddcuments only in the results matrix -----------------------</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;ocurrence&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="n">column_r</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="n">column_c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.tdf"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.tdf">[docs]</a>    <span class="k">def</span> <span class="nf">tdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True))</span>
<span class="sd">        &gt;&gt;&gt; rdf.tdf(&#39;Authors&#39;, sep=&#39;,&#39;, top_n=5).head() # doctest: +ELLIPSIS +NORMALIZE_WHITESPACE</span>
<span class="sd">           Wang J.  Zhang G.  Yan X.  Hernandez G.  Tefas A.</span>
<span class="sd">        0      0.0       0.0     0.0           0.0       0.0</span>
<span class="sd">        1      0.0       0.0     0.0           0.0       0.0</span>
<span class="sd">        2      0.0       0.0     0.0           0.0       0.0</span>
<span class="sd">        3      1.0       0.0     0.0           0.0       0.0</span>
<span class="sd">        4      0.0       0.0     0.0           0.0       0.0</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">## computa los N terminos mas frecuentes</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
            <span class="n">terms</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">]</span>
        
        <span class="n">tdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">))),</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">terms</span><span class="p">,</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">txt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="p">[</span><span class="n">txt</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> 
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
                        <span class="n">tdf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">tdf</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.terms_by_terms_by_year"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.terms_by_terms_by_year">[docs]</a>    <span class="k">def</span> <span class="nf">terms_by_terms_by_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="n">sep_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep_c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.terms_by_terms_by_year(column_r=&#39;Authors&#39;, sep_r=&#39;,&#39;, column_c=&#39;Author Keywords&#39;, sep_c=&#39;;&#39;, top_n=5)</span>
<span class="sd">                       Authors            Author Keywords      Year  Num Documents                 ID</span>
<span class="sd">        519   Hernandez G. [2]          Deep learning [7]  2018 [4]              2  [[*94*], [*100*]]</span>
<span class="sd">        1582       Wang J. [3]          Deep Learning [2]  2019 [5]              1           [[*15*]]</span>
<span class="sd">        1583       Wang J. [3]          Deep learning [7]  2018 [4]              1           [[*87*]]</span>
<span class="sd">        1584       Wang J. [3]          Deep learning [7]  2019 [5]              1            [[*3*]]</span>
<span class="sd">        1741        Yan X. [2]          Deep learning [7]  2019 [5]              1           [[*13*]]</span>
<span class="sd">        1745        Yan X. [2]  Financial time series [2]  2019 [5]              1           [[*13*]]</span>
<span class="sd">        1853      Zhang G. [4]          Deep Learning [2]  2018 [4]              1           [[*78*]]</span>
<span class="sd">        1854      Zhang G. [4]          Deep learning [7]  2017 [2]              1          [[*117*]]</span>
<span class="sd">        1855      Zhang G. [4]          Deep learning [7]  2019 [5]              1           [[*27*]]</span>
<span class="sd">        1856      Zhang G. [4]  Financial time series [2]  2017 [2]              1          [[*119*]]</span>
<span class="sd">        </span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">## computes the number of documents by term by term</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_r</span><span class="p">,</span> <span class="n">sep_r</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="n">sep_c</span><span class="p">)</span>
        
        <span class="n">numdocs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">column_r</span><span class="p">,</span> <span class="n">column_c</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

        <span class="c1">## results dataframe</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">column_r</span> <span class="p">:</span> <span class="n">a</span><span class="p">,</span>
            <span class="n">column_c</span> <span class="p">:</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;Year&#39;</span> <span class="p">:</span> <span class="n">y</span><span class="p">,</span>
            <span class="s1">&#39;Num Documents&#39;</span> <span class="p">:</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">})</span>

        <span class="c1">## compute top_n terms</span>
        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">## rows</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column_r</span><span class="p">,</span> <span class="n">sep_r</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">][</span><span class="n">column_r</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">top</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span> 
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>

            <span class="c1">## cols</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column_c</span><span class="p">,</span> <span class="n">sep_c</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">][</span><span class="n">column_c</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">top</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span> 
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>
            
        <span class="n">result</span> <span class="o">=</span> <span class="n">_minmax</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">minmax</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">term0</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">term1</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">term2</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
                <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column_r</span><span class="p">]</span> <span class="o">==</span> <span class="n">term0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column_c</span><span class="p">]</span> <span class="o">==</span> <span class="n">term1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">term2</span><span class="p">)</span>
            <span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1">## counts the number of ddcuments only in the results matrix -----------------------</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;terms_by_terms_by_year&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="n">column_r</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="n">column_c</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="c1">#----------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="RecordsDataFrame.terms_by_year"><a class="viewcode-back" href="../../dataframe.html#techminer.dataframe.RecordsDataFrame.terms_by_year">[docs]</a>    <span class="k">def</span> <span class="nf">terms_by_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; rdf = RecordsDataFrame(</span>
<span class="sd">        ...     pd.read_json(&#39;./data/cleaned.json&#39;, orient=&#39;records&#39;, lines=True)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; rdf.terms_by_year(column=&#39;Author Keywords&#39;, sep=&#39;;&#39;, top_n=5).head()</span>
<span class="sd">              Author Keywords       Year  Num Documents                                                ID</span>
<span class="sd">        0  Deep Learning [10]  2018 [37]              6  [[*54*], [*78*], [*79*], [*86*], [*95*], [*97*]]</span>
<span class="sd">        1  Deep Learning [10]  2019 [27]              4                  [[*15*], [*23*], [*26*], [*36*]]</span>
<span class="sd">        2  Deep learning [34]   2013 [3]              1                                         [[*134*]]</span>
<span class="sd">        3  Deep learning [34]   2016 [2]              1                                         [[*125*]]</span>
<span class="sd">        4  Deep learning [34]   2017 [7]              2                                [[*117*], [*120*]]</span>

<span class="sd">        &gt;&gt;&gt; rdf.terms_by_year(&#39;Author Keywords&#39;,  minmax=(2,3), sep=&#39;;&#39;).head()</span>
<span class="sd">                             Author Keywords       Year  Num Documents                  ID</span>
<span class="sd">        0                          ARIMA [2]  2017 [13]              2  [[*115*], [*122*]]</span>
<span class="sd">        1                            CNN [4]  2018 [47]              2    [[*72*], [*89*]]</span>
<span class="sd">        2                            CNN [4]  2019 [33]              2    [[*18*], [*50*]]</span>
<span class="sd">        3  Convolutional Neural Networks [2]  2018 [47]              2    [[*78*], [*79*]]</span>
<span class="sd">        4   Convolutional neural network [4]  2018 [47]              2    [[*64*], [*77*]]</span>

<span class="sd">        &gt;&gt;&gt; rdf.terms_by_year(&#39;Author Keywords&#39;,  top_n=3, minmax=(1,3), sep=&#39;;&#39;).head()</span>
<span class="sd">             Author Keywords      Year  Num Documents                  ID</span>
<span class="sd">        0  Deep learning [4]  2013 [3]              1           [[*134*]]</span>
<span class="sd">        1  Deep learning [4]  2016 [1]              1           [[*125*]]</span>
<span class="sd">        2  Deep learning [4]  2017 [5]              2  [[*117*], [*120*]]</span>
<span class="sd">        3           LSTM [6]  2013 [3]              2  [[*133*], [*135*]]</span>
<span class="sd">        4           LSTM [6]  2015 [1]              1           [[*130*]]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">## computes the number of documents by year</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="n">column</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_expand_column</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>

        <span class="n">numdocs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">column</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

        <span class="c1">## dataframe with results</span>
        <span class="n">idx_term</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">idx_year</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="n">column</span> <span class="p">:</span> <span class="n">idx_term</span><span class="p">,</span>
            <span class="s1">&#39;Year&#39;</span> <span class="p">:</span> <span class="n">idx_year</span><span class="p">,</span>
            <span class="s1">&#39;Num Documents&#39;</span> <span class="p">:</span> <span class="n">numdocs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">})</span>

        <span class="c1">## compute top_n terms</span>
        <span class="k">if</span> <span class="n">top_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents_by_terms</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">top_n</span><span class="p">:</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">top_n</span><span class="p">][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">top</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span> 
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">selected</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">_minmax</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">minmax</span><span class="p">)</span>
        
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">current_term</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">selected_IDs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_term</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">)][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_IDs</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="c1">## adds the number of documents to text ---------------------------------------------------</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="s1">&#39;terms_by_year&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_add_count_to_label</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div></div>





</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">techMiner - A Package for Bibliographical Analysis using Python 0.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Juan D. Velasquez &amp; Ivanohe J. Garces.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>